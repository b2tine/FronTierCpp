#!/bin/bash

source ~/.bashrc

export CC=mpicc
export CFLAGS=-w

export CXX=mpic++
export CXXFLAGS="-std=c++14 -w"

function config_intruder {
    CONF="--with-mpi --with-petsc-dir=/opt/petsc3.1-mpich2 --with-hdf4-dir=/opt/hdf --with-gd-dir=/opt/gd --with-cgal-dir=/opt/cgal"
}

function config_omega {
    CONF="--with-mpich-dir=/usr/local/pkg/mpich2-3.2 --with-petsc-dir=/usr/local/pkg/petsc --with-hdf4-dir=/usr/local/pkg/hdf --with-gd-inc=/usr/include --with-gd-lib=/usr/lib/x86_64-linux-gnu --with-cgal-inc=/usr/include --with-cgal-lib=/usr/lib/x86_64-linux-gnu --with-arma-inc=/usr/include --with-arma-lib=/usr/lib"
}

function config_lambda {
    CONF="--with-mpich-dir=/usr/local/pkg/mpich2-3.2 --with-petsc-dir=/usr/local/pkg/petsc --with-hdf4-dir=/usr/local/pkg/hdf4-2.10 --with-gd-inc=/usr/include --with-gd-lib=/usr/lib/x86_64-linux-gnu --with-cgal-inc=/usr/include --with-cgal-lib=/usr/lib/x86_64-linux-gnu --with-arma-inc=/usr/include --with-arma-lib=/usr/lib"
}

function config_alpha {
    CONF="--with-mpich-dir=/usr/local/pkg/mpich-3.2.1 --with-petsc-dir=/usr/local/pkg/petsc --with-hdf4-dir=/usr/local/pkg/hdf4-2.10 --with-gd-inc=/usr/include --with-gd-lib=/usr/lib/x86_64-linux-gnu --with-cgal-inc=/usr/include --with-cgal-lib=/usr/lib/x86_64-linux-gnu --with-arma-inc=/usr/include --with-arma-lib=/usr/lib"
}

function config_defiant {
    CONF="--with-mpich-dir=/usr/local/mpich-3.2.1 --with-petsc-dir=/usr/local/petsc --with-hdf4-dir=/usr/local/hdf4-2.10 --with-gd-inc=/usr/include --with-gd-lib=/usr/lib/x86_64-linux-gnu --with-cgal-inc=/usr/include --with-cgal-lib=/usr/lib/x86_64-linux-gnu --with-arma-inc=/usr/include --with-arma-lib=/usr/lib"
}


HOST=`uname -n`

if [[ "$HOST" == intruder.cluster ]]; then
    echo "Machine recognized as intruder."
    config_intruder
elif [[ "$HOST" == omega ]]; then
    echo "Machine recognized as omega."
    config_omega
elif [[ "$HOST" == lambda ]]; then
    echo "Machine recognized as lambda."
    config_lambda
elif [[ "$HOST" == alpha ]]; then
    echo "Machine recognized as alpha."
    config_alpha
elif [[ "$HOST" == defiant ]]; then
    echo "Machine recognized as defiant."
    config_defiant
fi


autoreconf -vif

echo "configure options: ${CONF}"

./configure ${CONF}

make
